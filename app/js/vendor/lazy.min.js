(function(context){function Lazy(e){if(e instanceof Array){return new ArrayWrapper(e)}else if(typeof e==="string"){return new StringWrapper(e)}else if(e instanceof Sequence){return e}if(Lazy.extensions){var t=Lazy.extensions,n=t.length,r;while(!r&&n--){r=t[n](e)}if(r){return r}}return new ObjectWrapper(e)}function Sequence(){}function Iterator(e){this.sequence=e;this.index=-1}function MemoizedSequence(e){this.parent=e}function MappedSequence(e,t){this.parent=e;this.mapFn=t}function MappingIterator(e,t){this.iterator=e.getIterator();this.mapFn=t;this.index=-1}function FilteredSequence(e,t){this.parent=e;this.filterFn=t}function FilteringIterator(e,t){this.iterator=e.getIterator();this.filterFn=t;this.index=0}function ReversedSequence(e){this.parent=e}function ReversedIterator(e){this.sequence=e}function ConcatenatedSequence(e,t){this.parent=e;this.arrays=t}function TakeSequence(e,t){this.parent=e;this.count=t}function TakeIterator(e,t){this.iterator=e.getIterator();this.count=t}function TakeWhileSequence(e,t){this.parent=e;this.predicate=t}function DropSequence(e,t){this.parent=e;this.count=typeof t==="number"?t:1}function DropWhileSequence(e,t){this.parent=e;this.predicate=t}function SortedSequence(e,t){this.parent=e;this.sortFn=t}function GroupedSequence(e,t){this.parent=e;this.keyFn=t}function IndexedSequence(e,t){this.parent=e;this.keyFn=t}function CountedSequence(e,t){this.parent=e;this.keyFn=t}function UniqueSequence(e,t){this.parent=e;this.keyFn=t}function ZippedSequence(e,t){this.parent=e;this.arrays=t}function ShuffledSequence(e){this.parent=e}function FlattenedSequence(e){this.parent=e}function WithoutSequence(e,t){this.parent=e;this.values=t}function IntersectionSequence(e,t){this.parent=e;this.arrays=t}function UniqueMemoizer(e){this.iterator=e;this.set=new Set;this.memo=[];this.currentValue=undefined}function ChunkedSequence(e,t){this.parent=e;this.chunkSize=t}function ChunkedIterator(e,t){this.iterator=e.getIterator();this.size=t}function TappedSequence(e,t){this.parent=e;this.callback=t}function SimpleIntersectionSequence(e,t){this.parent=e;this.array=t;this.each=getEachForIntersection(t)}function getEachForIntersection(e){if(e.length<40){return SimpleIntersectionSequence.prototype.eachArrayCache}else{return SimpleIntersectionSequence.prototype.eachMemoizerCache}}function SimpleZippedSequence(e,t){this.parent=e;this.array=t}function ArrayLikeSequence(){}function IndexedIterator(e){this.sequence=e;this.index=-1}function IndexedMappedSequence(e,t){this.parent=e;this.mapFn=t}function IndexedFilteredSequence(e,t){this.parent=e;this.filterFn=t}function IndexedReversedSequence(e){this.parent=e}function IndexedTakeSequence(e,t){this.parent=e;this.count=t}function IndexedDropSequence(e,t){this.parent=e;this.count=typeof t==="number"?t:1}function IndexedConcatenatedSequence(e,t){this.parent=e;this.other=t}function IndexedUniqueSequence(e,t){this.parent=e;this.each=getEachForParent(e);this.keyFn=t}function getEachForParent(e){if(e.length()<100){return IndexedUniqueSequence.prototype.eachArrayCache}else{return UniqueSequence.prototype.each}}function ArrayWrapper(e){this.source=e}function MappedArrayWrapper(e,t){this.parent=e;this.mapFn=t}function FilteredArrayWrapper(e,t){this.parent=e;this.filterFn=t}function UniqueArrayWrapper(e,t){this.parent=e;this.each=getEachForSource(e.source);this.keyFn=t}function getEachForSource(e){if(e.length<40){return UniqueArrayWrapper.prototype.eachNoCache}else if(e.length<100){return UniqueArrayWrapper.prototype.eachArrayCache}else{return UniqueArrayWrapper.prototype.eachSetCache}}function ConcatArrayWrapper(e,t){this.parent=e;this.other=t}function ObjectLikeSequence(){}function AssignSequence(e,t){this.parent=e;this.other=t}function DefaultsSequence(e,t){this.parent=e;this.defaults=t}function InvertedSequence(e){this.parent=e}function MergedSequence(e,t,n){this.parent=e;this.others=t;this.mergeFn=n}function mergeObjects(e,t){if(typeof t==="undefined"){return e}if(typeof e!=="object"||e===null||typeof t!=="object"||t===null){return t}var n={},r;for(r in e){n[r]=mergeObjects(e[r],t[r])}for(r in t){if(!n[r]){n[r]=t[r]}}return n}function PickSequence(e,t){this.parent=e;this.properties=t}function OmitSequence(e,t){this.parent=e;this.properties=t}function ObjectWrapper(e){this.source=e}function StringLikeSequence(){}function CharIterator(e){this.source=Lazy(e);this.index=-1}function StringSegment(e,t,n){this.parent=e;this.start=Math.max(0,t);this.stop=n}function MappedStringLikeSequence(e,t){this.parent=e;this.mapFn=t}function ReversedStringLikeSequence(e){this.parent=e}function StringMatchSequence(e,t){this.source=e;this.pattern=t}function StringMatchIterator(e,t){this.source=e;this.pattern=cloneRegex(t)}function SplitStringSequence(e,t){this.source=e;this.pattern=t}function SplitWithRegExpIterator(e,t){this.source=e;this.pattern=cloneRegex(t)}function SplitWithStringIterator(e,t){this.source=e;this.delimiter=t}function StringWrapper(e){this.source=e}function GeneratedSequence(e,t){this.get=e;this.fixedLength=t}function GeneratedIterator(e){this.sequence=e;this.index=0;this.currentValue=null}function AsyncSequence(e,t){if(e instanceof AsyncSequence){throw new Error("Sequence is already asynchronous!")}this.parent=e;this.interval=t;this.onNextCallback=getOnNextCallback(t);this.cancelCallback=getCancelCallback(t)}function AsyncHandle(e){this.resolveListeners=[];this.rejectListeners=[];this.state=PENDING;this.cancelFn=e}function resolve(e,t){if(e===t){e._reject(new TypeError("Cannot resolve a promise to itself"));return}if(t instanceof AsyncHandle){t.then(function(t){resolve(e,t)},function(t){e._reject(t)});return}var n;try{n=/function|object/.test(typeof t)&&t!=null&&t.then}catch(r){e._reject(r);return}var i=PENDING;if(typeof n==="function"){try{n.call(t,function(n){if(i!==PENDING){return}i=RESOLVED;resolve(e,n)},function(n){if(i!==PENDING){return}i=REJECTED;e._reject(n)})}catch(r){if(i!==PENDING){return}e._reject(r)}return}e._resolve(t)}function consumeListeners(e,t,n){n||(n=getOnNextCallback());n(function(){if(e.length>0){e.shift()(t);consumeListeners(e,t,n)}})}function getOnNextCallback(e){if(typeof e==="undefined"){if(typeof setImmediate==="function"){return setImmediate}}e=e||0;return function(t){return setTimeout(t,e)}}function getCancelCallback(e){if(typeof e==="undefined"){if(typeof clearImmediate==="function"){return clearImmediate}}return clearTimeout}function transform(e,t){if(t instanceof AsyncHandle){return t.then(function(){e(t)})}return e(t)}function WatchedPropertySequence(e,t){this.listeners=[];if(!t){t=Lazy(e).keys().toArray()}else if(!(t instanceof Array)){t=[t]}var n=this.listeners,r=0;Lazy(t).each(function(t){var i=e[t];Object.defineProperty(e,t,{get:function(){return i},set:function(e){for(var s=n.length-1;s>=0;--s){if(n[s]({property:t,value:e},r)===false){n.splice(s,1)}}i=e;++r}})})}function StreamLikeSequence(){}function SplitStreamSequence(e,t){this.parent=e;this.delimiter=t;this.each=this.getEachForDelimiter(t)}function MatchedStreamSequence(e,t){this.parent=e;this.pattern=cloneRegex(t)}function createCallback(e,t){switch(typeof e){case"function":return e;case"string":return function(t){return t[e]};case"object":return function(t){return Lazy(e).all(function(e,n){return t[n]===e})};case"undefined":return t?function(){return t}:Lazy.identity;default:throw new Error("Don't know how to make a callback from a "+typeof e+"!")}}function createComparator(e,t){if(!e){return compare}e=createCallback(e);return function(t,n){return compare(e(t),e(n))}}function reverseArguments(e){return function(t,n){return e(n,t)}}function createSet(e){var t=new Set;Lazy(e||[]).flatten().each(function(e){t.add(e)});return t}function compare(e,t){if(e===t){return 0}return e>t?1:-1}function forEach(e,t){var n=-1,r=e.length;while(++n<r){if(t(e[n],n)===false){return false}}return true}function getFirst(e){var t;e.each(function(e){t=e;return false});return t}function arrayContains(e,t){var n=-1,r=e.length;if(t!==t){while(++n<r){if(e[n]!==e[n]){return true}}return false}while(++n<r){if(e[n]===t){return true}}return false}function arrayContainsBefore(e,t,n,r){var i=-1;if(r){r=createCallback(r);while(++i<n){if(r(e[i])===r(t)){return true}}}else{while(++i<n){if(e[i]===t){return true}}}return false}function swap(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function cloneRegex(pattern){return eval(""+pattern+(!pattern.global?"g":""))}function Set(){this.table={};this.objects=[]}function Queue(e){this.contents=new Array(e);this.start=0;this.count=0}function defineSequenceType(e,t,n){var r=function(){};r.prototype=new e;for(var i in n){r.prototype[i]=n[i]}var s=function(){var t=new r;t.parent=this;if(t.init){t.init.apply(t,arguments)}return t};var o=typeof t==="string"?[t]:t;for(var u=0;u<o.length;++u){e.prototype[o[u]]=s}return r}Lazy.VERSION="0.3.2";Lazy.noop=function(){};Lazy.identity=function(t){return t};Lazy.strict=function(){function t(e){if(e==null){throw new Error("You cannot wrap null or undefined using Lazy.")}if(typeof e==="number"||typeof e==="boolean"){throw new Error("You cannot wrap primitive values using Lazy.")}return Lazy(e)}Lazy(Lazy).each(function(e,n){t[n]=e});return t};Sequence.define=function(t,n){if(!n||!n.getIterator&&!n.each){throw new Error("A custom sequence must implement *at least* getIterator or each!")}return defineSequenceType(Sequence,t,n)};Sequence.prototype.size=function(){return this.getIndex().length()};Sequence.prototype.getIterator=function(){return new Iterator(this)};Sequence.prototype.root=function(){return this.parent.root()};Sequence.prototype.isAsync=function(){return this.parent?this.parent.isAsync():false};Sequence.prototype.value=function(){return this.toArray()};Sequence.prototype.apply=function(t){var n=this.root(),r=n.source,i;try{n.source=t;i=this.value()}finally{n.source=r}return i};Iterator.prototype.current=function(){return this.cachedIndex&&this.cachedIndex.get(this.index)};Iterator.prototype.moveNext=function(){var t=this.cachedIndex;if(!t){t=this.cachedIndex=this.sequence.getIndex()}if(this.index>=t.length()-1){return false}++this.index;return true};Sequence.prototype.toArray=function(){return this.reduce(function(e,t){e.push(t);return e},[])};Sequence.prototype.getIndex=function(){if(!this.cachedIndex){this.cachedIndex=new ArrayWrapper(this.toArray())}return this.cachedIndex};Sequence.prototype.memoize=function(){return new MemoizedSequence(this)};Sequence.prototype.toObject=function(){return this.reduce(function(e,t){e[t[0]]=t[1];return e},{})};Sequence.prototype.each=function(t){var n=this.getIterator(),r=-1;while(n.moveNext()){if(t(n.current(),++r)===false){return false}}return true};Sequence.prototype.forEach=function(t){return this.each(t)};Sequence.prototype.map=function(t){return new MappedSequence(this,createCallback(t))};Sequence.prototype.collect=function(t){return this.map(t)};MappedSequence.prototype=new Sequence;MappedSequence.prototype.getIterator=function(){return new MappingIterator(this.parent,this.mapFn)};MappedSequence.prototype.each=function(t){var n=this.mapFn;return this.parent.each(function(e,r){return t(n(e,r),r)})};MappingIterator.prototype.current=function(){return this.mapFn(this.iterator.current(),this.index)};MappingIterator.prototype.moveNext=function(){if(this.iterator.moveNext()){++this.index;return true}return false};Sequence.prototype.pluck=function(t){return this.map(t)};Sequence.prototype.invoke=function(t){return this.map(function(e){return e[t]()})};Sequence.prototype.filter=function(t){return new FilteredSequence(this,createCallback(t))};Sequence.prototype.select=function(t){return this.filter(t)};FilteredSequence.prototype=new Sequence;FilteredSequence.prototype.getIterator=function(){return new FilteringIterator(this.parent,this.filterFn)};FilteredSequence.prototype.each=function(t){var n=this.filterFn;if(this.parent instanceof ObjectLikeSequence){return this.parent.each(function(e,r){if(n(e,r)){return t(e,r)}})}else{var r=0;return this.parent.each(function(e,i){if(n(e,i)){return t(e,r++)}})}};FilteredSequence.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)};FilteringIterator.prototype.current=function(){return this.value};FilteringIterator.prototype.moveNext=function(){var t=this.iterator,n=this.filterFn,r;while(t.moveNext()){r=t.current();if(n(r,this.index++)){this.value=r;return true}}this.value=undefined;return false};Sequence.prototype.reject=function(t){t=createCallback(t);return this.filter(function(e){return!t(e)})};Sequence.prototype.ofType=function(t){return this.filter(function(e){return typeof e===t})};Sequence.prototype.where=function(t){return this.filter(t)};Sequence.prototype.reverse=function(){return new ReversedSequence(this)};ReversedSequence.prototype=new Sequence;ReversedSequence.prototype.getIterator=function(){return new ReversedIterator(this.parent)};ReversedIterator.prototype.current=function(){return this.sequence.getIndex().get(this.index)};ReversedIterator.prototype.moveNext=function(){var t=this.sequence.getIndex(),n=t.length();if(typeof this.index==="undefined"){this.index=n}return--this.index>=0};Sequence.prototype.concat=function(t){return new ConcatenatedSequence(this,arraySlice.call(arguments,0))};ConcatenatedSequence.prototype=new Sequence;ConcatenatedSequence.prototype.each=function(t){var n=false,r=0;this.parent.each(function(e){if(t(e,r++)===false){n=true;return false}});if(!n){Lazy(this.arrays).flatten().each(function(e){if(t(e,r++)===false){return false}})}};Sequence.prototype.first=function(t){if(typeof t==="undefined"){return getFirst(this)}return new TakeSequence(this,t)};Sequence.prototype.head=Sequence.prototype.take=function(e){return this.first(e)};TakeSequence.prototype=new Sequence;TakeSequence.prototype.getIterator=function(){return new TakeIterator(this.parent,this.count)};TakeSequence.prototype.each=function(t){var n=this.count,r=0;var i=this.parent.each(function(e){var i;if(r<n){i=t(e,r++)}if(r>=n){return false}return i});if(i instanceof AsyncHandle){return i}return r===n};TakeIterator.prototype.current=function(){return this.iterator.current()};TakeIterator.prototype.moveNext=function(){return--this.count>=0&&this.iterator.moveNext()};Sequence.prototype.takeWhile=function(t){return new TakeWhileSequence(this,t)};TakeWhileSequence.prototype=new Sequence;TakeWhileSequence.prototype.each=function(t){var n=this.predicate,r=false,i=0;var s=this.parent.each(function(e,s){if(!n(e,s)){r=true;return false}return t(e,i++)});if(s instanceof AsyncHandle){return s}return r};Sequence.prototype.initial=function(t){if(typeof t==="undefined"){t=1}return this.take(this.getIndex().length()-t)};Sequence.prototype.last=function(t){if(typeof t==="undefined"){return this.reverse().first()}return this.reverse().take(t).reverse()};Sequence.prototype.findWhere=function(t){return this.where(t).first()};Sequence.prototype.rest=function(t){return new DropSequence(this,t)};Sequence.prototype.skip=Sequence.prototype.tail=Sequence.prototype.drop=function(t){return this.rest(t)};DropSequence.prototype=new Sequence;DropSequence.prototype.each=function(t){var n=this.count,r=0,i=0;return this.parent.each(function(e){if(r++<n){return}return t(e,i++)})};Sequence.prototype.dropWhile=function(t){return new DropWhileSequence(this,t)};Sequence.prototype.skipWhile=function(t){return this.dropWhile(t)};DropWhileSequence.prototype=new Sequence;DropWhileSequence.prototype.each=function(t){var n=this.predicate,r=false;return this.parent.each(function(e){if(!r){if(n(e)){return}r=true}return t(e)})};Sequence.prototype.sort=function(t,n){t||(t=compare);if(n){t=reverseArguments(t)}return new SortedSequence(this,t)};Sequence.prototype.sortBy=function(t,n){t=createComparator(t);if(n){t=reverseArguments(t)}return new SortedSequence(this,t)};SortedSequence.prototype=new Sequence;SortedSequence.prototype.each=function(t){var n=this.sortFn,r=this.parent.toArray();r.sort(n);return forEach(r,t)};SortedSequence.prototype.reverse=function(){return new SortedSequence(this.parent,reverseArguments(this.sortFn))};Sequence.prototype.groupBy=function(t){return new GroupedSequence(this,t)};Sequence.prototype.indexBy=function(e){return new IndexedSequence(this,e)};Sequence.prototype.countBy=function(t){return new CountedSequence(this,t)};Sequence.prototype.uniq=function(t){return new UniqueSequence(this,t)};Sequence.prototype.unique=function(t){return this.uniq(t)};UniqueSequence.prototype=new Sequence;UniqueSequence.prototype.each=function(t){var n=new Set,r=this.keyFn,i=0;if(r){r=createCallback(r);return this.parent.each(function(e){if(n.add(r(e))){return t(e,i++)}})}else{return this.parent.each(function(e){if(n.add(e)){return t(e,i++)}})}};Sequence.prototype.zip=function(t){if(arguments.length===1){return new SimpleZippedSequence(this,t)}else{return new ZippedSequence(this,arraySlice.call(arguments,0))}};ZippedSequence.prototype=new Sequence;ZippedSequence.prototype.each=function(t){var n=this.arrays,r=0;this.parent.each(function(e){var s=[e];for(var o=0;o<n.length;++o){if(n[o].length>r){s.push(n[o][r])}}return t(s,r++)})};Sequence.prototype.shuffle=function(){return new ShuffledSequence(this)};ShuffledSequence.prototype=new Sequence;ShuffledSequence.prototype.each=function(t){var n=this.parent.toArray(),r=Math.floor,i=Math.random,s=0;for(var o=n.length-1;o>0;--o){swap(n,o,r(i()*o)+1);if(t(n[o],s++)===false){return}}t(n[0],s)};Sequence.prototype.flatten=function(){return new FlattenedSequence(this)};FlattenedSequence.prototype=new Sequence;FlattenedSequence.prototype.each=function(t){var n=0;return this.parent.each(function r(e){if(e instanceof Array){return forEach(e,r)}if(e instanceof Sequence){return e.each(r)}return t(e,n++)})};Sequence.prototype.compact=function(){return this.filter(function(e){return!!e})};Sequence.prototype.without=function(t){return new WithoutSequence(this,arraySlice.call(arguments,0))};Sequence.prototype.difference=function(t){return this.without.apply(this,arguments)};WithoutSequence.prototype=new Sequence;WithoutSequence.prototype.each=function(t){var n=createSet(this.values),r=0;return this.parent.each(function(e){if(!n.contains(e)){return t(e,r++)}})};Sequence.prototype.union=function(t){return this.concat(t).uniq()};Sequence.prototype.intersection=function(t){if(arguments.length===1&&arguments[0]instanceof Array){return new SimpleIntersectionSequence(this,t)}else{return new IntersectionSequence(this,arraySlice.call(arguments,0))}};IntersectionSequence.prototype=new Sequence;IntersectionSequence.prototype.each=function(t){var n=Lazy(this.arrays).map(function(e){return new UniqueMemoizer(Lazy(e).getIterator())});var r=new UniqueMemoizer(n.getIterator()),i=0;return this.parent.each(function(e){var n=true;r.each(function(t){if(!t.contains(e)){n=false;return false}});if(n){return t(e,i++)}})};UniqueMemoizer.prototype.current=function(){return this.currentValue};UniqueMemoizer.prototype.moveNext=function(){var t=this.iterator,n=this.set,r=this.memo,i;while(t.moveNext()){i=t.current();if(n.add(i)){r.push(i);this.currentValue=i;return true}}return false};UniqueMemoizer.prototype.each=function(t){var n=this.memo,r=n.length,i=-1;while(++i<r){if(t(n[i],i)===false){return false}}while(this.moveNext()){if(t(this.currentValue,i++)===false){break}}};UniqueMemoizer.prototype.contains=function(t){if(this.set.contains(t)){return true}while(this.moveNext()){if(this.currentValue===t){return true}}return false};Sequence.prototype.every=function(t){t=createCallback(t);return this.each(function(e,n){return!!t(e,n)})};Sequence.prototype.all=function(t){return this.every(t)};Sequence.prototype.some=function(t){t=createCallback(t,true);var n=false;this.each(function(e){if(t(e)){n=true;return false}});return n};Sequence.prototype.any=function(t){return this.some(t)};Sequence.prototype.none=function(t){return!this.any(t)};Sequence.prototype.isEmpty=function(){return!this.any()};Sequence.prototype.indexOf=function(t){var n=-1;this.each(function(e,r){if(e===t){n=r;return false}});return n};Sequence.prototype.lastIndexOf=function(t){var n=this.reverse().indexOf(t);if(n!==-1){n=this.getIndex().length()-n-1}return n};Sequence.prototype.sortedIndex=function(t){var n=this.getIndex(),r=0,i=n.length(),s;while(r<i){s=r+i>>>1;if(compare(n.get(s),t)===-1){r=s+1}else{i=s}}return r};Sequence.prototype.contains=function(t){return this.indexOf(t)!==-1};Sequence.prototype.reduce=function(t,n){if(arguments.length<2){return this.tail().reduce(t,this.head())}var r=this.each(function(e,r){n=t(n,e,r)});if(r instanceof AsyncHandle){return r.then(function(){return n})}return n};Sequence.prototype.inject=Sequence.prototype.foldl=function(t,n){return this.reduce(t,n)};Sequence.prototype.reduceRight=function(t,n){if(arguments.length<2){return this.initial(1).reduceRight(t,this.last())}var r=this.getIndex().length()-1;return this.reverse().reduce(function(e,n){return t(e,n,r--)},n)};Sequence.prototype.foldr=function(t,n){return this.reduceRight(t,n)};Sequence.prototype.consecutive=function(t){var n=new Queue(t);var r=this.map(function(e){if(n.add(e).count===t){return n.toArray()}});return r.compact()};Sequence.prototype.chunk=function(t){if(t<1){throw new Error("You must specify a positive chunk size.")}return new ChunkedSequence(this,t)};ChunkedSequence.prototype=new Sequence;ChunkedSequence.prototype.getIterator=function(){return new ChunkedIterator(this.parent,this.chunkSize)};ChunkedIterator.prototype.current=function(){return this.currentChunk};ChunkedIterator.prototype.moveNext=function(){var t=this.iterator,n=this.size,r=[];while(r.length<n&&t.moveNext()){r.push(t.current())}if(r.length===0){return false}this.currentChunk=r;return true};Sequence.prototype.tap=function(t){return new TappedSequence(this,t)};TappedSequence.prototype=new Sequence;TappedSequence.prototype.each=function(t){var n=this.callback;return this.parent.each(function(e,r){n(e,r);return t(e,r)})};Sequence.prototype.find=function(t){return this.filter(t).first()};Sequence.prototype.detect=function(t){return this.find(t)};Sequence.prototype.min=function(t){if(typeof t!=="undefined"){return this.minBy(t)}return this.reduce(function(e,t){return t<e?t:e},Infinity)};Sequence.prototype.minBy=function(t){t=createCallback(t);return this.reduce(function(e,n){return t(n)<t(e)?n:e})};Sequence.prototype.max=function(t){if(typeof t!=="undefined"){return this.maxBy(t)}return this.reduce(function(e,t){return t>e?t:e},-Infinity)};Sequence.prototype.maxBy=function(t){t=createCallback(t);return this.reduce(function(e,n){return t(n)>t(e)?n:e})};Sequence.prototype.sum=function(t){if(typeof t!=="undefined"){return this.sumBy(t)}return this.reduce(function(e,t){return e+t},0)};Sequence.prototype.sumBy=function(t){t=createCallback(t);return this.reduce(function(e,n){return e+t(n)},0)};Sequence.prototype.join=function(t){t=typeof t==="string"?t:",";return this.reduce(function(e,n){if(e.length>0){e+=t}return e+n},"")};Sequence.prototype.toString=function toString(e){return this.join(e)};Sequence.prototype.async=function(t){return new AsyncSequence(this,t)};SimpleIntersectionSequence.prototype=new Sequence;SimpleIntersectionSequence.prototype.eachMemoizerCache=function(t){var n=new UniqueMemoizer(Lazy(this.array).getIterator()),r=0;return this.parent.each(function(e){if(n.contains(e)){return t(e,r++)}})};SimpleIntersectionSequence.prototype.eachArrayCache=function(t){var n=this.array,r=arrayContains,i=0;return this.parent.each(function(e){if(r(n,e)){return t(e,i++)}})};SimpleZippedSequence.prototype=new Sequence;SimpleZippedSequence.prototype.each=function(t){var n=this.array;return this.parent.each(function(e,r){return t([e,n[r]],r)})};ArrayLikeSequence.prototype=new Sequence;ArrayLikeSequence.define=function(t,n){if(!n||typeof n.get!=="function"){throw new Error("A custom array-like sequence must implement *at least* get!")}return defineSequenceType(ArrayLikeSequence,t,n)};ArrayLikeSequence.prototype.get=function(t){return this.parent.get(t)};ArrayLikeSequence.prototype.length=function(){return this.parent.length()};ArrayLikeSequence.prototype.getIndex=function(){return this};ArrayLikeSequence.prototype.getIterator=function(){return new IndexedIterator(this)};IndexedIterator.prototype.current=function(){return this.sequence.get(this.index)};IndexedIterator.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1){return false}++this.index;return true};ArrayLikeSequence.prototype.each=function(t){var n=this.length(),r=-1;while(++r<n){if(t(this.get(r),r)===false){return false}}return true};ArrayLikeSequence.prototype.pop=function(){return this.initial()};ArrayLikeSequence.prototype.shift=function(){return this.drop()};ArrayLikeSequence.prototype.slice=function(t,n){var r=this.length();if(t<0){t=r+t}var i=this.drop(t);if(typeof n==="number"){if(n<0){n=r+n}i=i.take(n-t)}return i};ArrayLikeSequence.prototype.map=function(t){return new IndexedMappedSequence(this,createCallback(t))};IndexedMappedSequence.prototype=new ArrayLikeSequence;IndexedMappedSequence.prototype.get=function(t){if(t<0||t>=this.parent.length()){return undefined}return this.mapFn(this.parent.get(t),t)};ArrayLikeSequence.prototype.filter=function(t){return new IndexedFilteredSequence(this,createCallback(t))};IndexedFilteredSequence.prototype=new FilteredSequence;IndexedFilteredSequence.prototype.each=function(t){var n=this.parent,r=this.filterFn,i=this.parent.length(),s=-1,o=0,u;while(++s<i){u=n.get(s);if(r(u,s)&&t(u,o++)===false){return false}}return true};ArrayLikeSequence.prototype.reverse=function(){return new IndexedReversedSequence(this)};IndexedReversedSequence.prototype=new ArrayLikeSequence;IndexedReversedSequence.prototype.get=function(t){return this.parent.get(this.length()-t-1)};ArrayLikeSequence.prototype.first=function(t){if(typeof t==="undefined"){return this.get(0)}return new IndexedTakeSequence(this,t)};IndexedTakeSequence.prototype=new ArrayLikeSequence;IndexedTakeSequence.prototype.length=function(){var t=this.parent.length();return this.count<=t?this.count:t};ArrayLikeSequence.prototype.rest=function(t){return new IndexedDropSequence(this,t)};IndexedDropSequence.prototype=new ArrayLikeSequence;IndexedDropSequence.prototype.get=function(t){return this.parent.get(this.count+t)};IndexedDropSequence.prototype.length=function(){var t=this.parent.length();return this.count<=t?t-this.count:0};ArrayLikeSequence.prototype.concat=function(t){if(arguments.length===1&&arguments[0]instanceof Array){return new IndexedConcatenatedSequence(this,t)}else{return Sequence.prototype.concat.apply(this,arguments)}};IndexedConcatenatedSequence.prototype=new ArrayLikeSequence;IndexedConcatenatedSequence.prototype.get=function(t){var n=this.parent.length();if(t<n){return this.parent.get(t)}else{return this.other[t-n]}};IndexedConcatenatedSequence.prototype.length=function(){return this.parent.length()+this.other.length};ArrayLikeSequence.prototype.uniq=function(t){return new IndexedUniqueSequence(this,createCallback(t))};IndexedUniqueSequence.prototype=new Sequence;IndexedUniqueSequence.prototype.eachArrayCache=function(t){var n=this.parent,r=this.keyFn,i=n.length(),s=[],o=arrayContains,u,a,f=-1,l=0;while(++f<i){a=n.get(f);u=r(a);if(!o(s,u)){s.push(u);if(t(a,l++)===false){return false}}}};IndexedUniqueSequence.prototype.eachSetCache=UniqueSequence.prototype.each;MemoizedSequence.prototype=new ArrayLikeSequence;MemoizedSequence.prototype.cache=function(){return this.cachedResult||(this.cachedResult=this.parent.toArray())};MemoizedSequence.prototype.get=function(t){return this.cache()[t]};MemoizedSequence.prototype.length=function(){return this.cache().length};MemoizedSequence.prototype.slice=function(t,n){return this.cache().slice(t,n)};MemoizedSequence.prototype.toArray=function(){return this.cache().slice(0)};ArrayWrapper.prototype=new ArrayLikeSequence;ArrayWrapper.prototype.root=function(){return this};ArrayWrapper.prototype.isAsync=function(){return false};ArrayWrapper.prototype.get=function(t){return this.source[t]};ArrayWrapper.prototype.length=function(){return this.source.length};ArrayWrapper.prototype.each=function(t){return forEach(this.source,t)};ArrayWrapper.prototype.map=function(t){return new MappedArrayWrapper(this,createCallback(t))};ArrayWrapper.prototype.filter=function(t){return new FilteredArrayWrapper(this,createCallback(t))};ArrayWrapper.prototype.uniq=function(t){return new UniqueArrayWrapper(this,t)};ArrayWrapper.prototype.concat=function(t){if(arguments.length===1&&arguments[0]instanceof Array){return new ConcatArrayWrapper(this,t)}else{return ArrayLikeSequence.prototype.concat.apply(this,arguments)}};ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)};MappedArrayWrapper.prototype=new ArrayLikeSequence;MappedArrayWrapper.prototype.get=function(t){var n=this.parent.source;if(t<0||t>=n.length){return undefined}return this.mapFn(n[t])};MappedArrayWrapper.prototype.length=function(){return this.parent.source.length};MappedArrayWrapper.prototype.each=function(t){var n=this.parent.source,r=n.length,i=this.mapFn,s=-1;while(++s<r){if(t(i(n[s],s),s)===false){return false}}return true};FilteredArrayWrapper.prototype=new FilteredSequence;FilteredArrayWrapper.prototype.each=function(t){var n=this.parent.source,r=this.filterFn,i=n.length,s=-1,o=0,u;while(++s<i){u=n[s];if(r(u,s)&&t(u,o++)===false){return false}}return true};UniqueArrayWrapper.prototype=new Sequence;UniqueArrayWrapper.prototype.eachNoCache=function(t){var n=this.parent.source,r=this.keyFn,i=n.length,s=arrayContainsBefore,o,u=-1,a=0;while(++u<i){o=n[u];if(!s(n,o,u,r)&&t(o,a++)===false){return false}}return true};UniqueArrayWrapper.prototype.eachArrayCache=function(t){var n=this.parent.source,r=this.keyFn,i=n.length,s=[],o=arrayContains,u,a,f=-1,l=0;if(r){r=createCallback(r);while(++f<i){a=n[f];u=r(a);if(!o(s,u)){s.push(u);if(t(a,l++)===false){return false}}}}else{while(++f<i){a=n[f];if(!o(s,a)){s.push(a);if(t(a,l++)===false){return false}}}}return true};UniqueArrayWrapper.prototype.eachSetCache=UniqueSequence.prototype.each;ConcatArrayWrapper.prototype=new ArrayLikeSequence;ConcatArrayWrapper.prototype.get=function(t){var n=this.parent.source,r=n.length;if(t<r){return n[t]}else{return this.other[t-r]}};ConcatArrayWrapper.prototype.length=function(){return this.parent.source.length+this.other.length};ConcatArrayWrapper.prototype.each=function(t){var n=this.parent.source,r=n.length,i=this.other,s=i.length,o=0,u=-1;while(++u<r){if(t(n[u],o++)===false){return false}}u=-1;while(++u<s){if(t(i[u],o++)===false){return false}}return true};ObjectLikeSequence.prototype=new Sequence;ObjectLikeSequence.define=function(t,n){if(!n||typeof n.each!=="function"){throw new Error("A custom object-like sequence must implement *at least* each!")}return defineSequenceType(ObjectLikeSequence,t,n)};ObjectLikeSequence.prototype.value=function(){return this.toObject()};ObjectLikeSequence.prototype.get=function(t){var n=this.pairs().find(function(e){return e[0]===t});return n?n[1]:undefined};ObjectLikeSequence.prototype.keys=function(){return this.map(function(e,t){return t})};ObjectLikeSequence.prototype.values=function(){return this.map(function(e,t){return e})};ObjectLikeSequence.prototype.async=function(){throw new Error("An ObjectLikeSequence does not support asynchronous iteration.")};ObjectLikeSequence.prototype.reverse=function(){return this};ObjectLikeSequence.prototype.assign=function(t){return new AssignSequence(this,t)};ObjectLikeSequence.prototype.extend=function(t){return this.assign(t)};AssignSequence.prototype=new ObjectLikeSequence;AssignSequence.prototype.get=function(t){return this.other[t]||this.parent.get(t)};AssignSequence.prototype.each=function(t){var n=new Set,r=false;Lazy(this.other).each(function(e,i){if(t(e,i)===false){r=true;return false}n.add(i)});if(!r){return this.parent.each(function(e,r){if(!n.contains(r)&&t(e,r)===false){return false}})}};ObjectLikeSequence.prototype.defaults=function defaults(defaults){return new DefaultsSequence(this,defaults)};DefaultsSequence.prototype=new ObjectLikeSequence;DefaultsSequence.prototype.get=function(t){return this.parent.get(t)||this.defaults[t]};DefaultsSequence.prototype.each=function(t){var n=new Set,r=false;this.parent.each(function(e,i){if(t(e,i)===false){r=true;return false}if(typeof e!=="undefined"){n.add(i)}});if(!r){Lazy(this.defaults).each(function(e,r){if(!n.contains(r)&&t(e,r)===false){return false}})}};ObjectLikeSequence.prototype.invert=function(){return new InvertedSequence(this)};InvertedSequence.prototype=new ObjectLikeSequence;InvertedSequence.prototype.each=function(t){this.parent.each(function(e,n){return t(n,e)})};ObjectLikeSequence.prototype.merge=function(t){var n=arguments.length>1&&typeof arguments[arguments.length-1]==="function"?arrayPop.call(arguments):null;return new MergedSequence(this,arraySlice.call(arguments,0),n)};MergedSequence.prototype=new ObjectLikeSequence;MergedSequence.prototype.each=function(t){var n=this.others,r=this.mergeFn||mergeObjects,i={};var s=this.parent.each(function(e,s){var o=e;forEach(n,function(e){if(s in e){o=r(o,e[s])}});i[s]=true;return t(o,s)});if(s===false){return false}var o={};forEach(n,function(e){for(var t in e){if(!i[t]){o[t]=r(o[t],e[t])}}});return Lazy(o).each(t)};ObjectLikeSequence.prototype.functions=function(){return this.filter(function(e,t){return typeof e==="function"}).map(function(e,t){return t})};ObjectLikeSequence.prototype.methods=function(){return this.functions()};ObjectLikeSequence.prototype.pick=function(t){return new PickSequence(this,t)};PickSequence.prototype=new ObjectLikeSequence;PickSequence.prototype.get=function(t){return arrayContains(this.properties,t)?this.parent.get(t):undefined};PickSequence.prototype.each=function(t){var n=arrayContains,r=this.properties;return this.parent.each(function(e,i){if(n(r,i)){return t(e,i)}})};ObjectLikeSequence.prototype.omit=function(t){return new OmitSequence(this,t)};OmitSequence.prototype=new ObjectLikeSequence;OmitSequence.prototype.get=function(t){return arrayContains(this.properties,t)?undefined:this.parent.get(t)};OmitSequence.prototype.each=function(t){var n=arrayContains,r=this.properties;return this.parent.each(function(e,i){if(!n(r,i)){return t(e,i)}})};ObjectLikeSequence.prototype.pairs=function(){return this.map(function(e,t){return[t,e]})};ObjectLikeSequence.prototype.toArray=function(){return this.pairs().toArray()};ObjectLikeSequence.prototype.toObject=function(){return this.reduce(function(e,t,n){e[n]=t;return e},{})};GroupedSequence.prototype=new ObjectLikeSequence;GroupedSequence.prototype.each=function(t){var n=createCallback(this.keyFn),r;r=this.parent.reduce(function(e,t){var r=n(t);if(!(e[r]instanceof Array)){e[r]=[t]}else{e[r].push(t)}return e},{});return transform(function(e){for(var n in e){if(t(e[n],n)===false){return false}}},r)};IndexedSequence.prototype=new ObjectLikeSequence;IndexedSequence.prototype.each=function(t){var n=createCallback(this.keyFn),r={};return this.parent.each(function(e){var i=n(e);if(!r[i]){r[i]=e;return t(e,i)}})};CountedSequence.prototype=new ObjectLikeSequence;CountedSequence.prototype.each=function(t){var n=createCallback(this.keyFn),r={};this.parent.each(function(e){var t=n(e);if(!r[t]){r[t]=1}else{r[t]+=1}});for(var i in r){if(t(r[i],i)===false){return false}}return true};ObjectLikeSequence.prototype.watch=function(t){throw new Error("You can only call #watch on a directly wrapped object.")};ObjectWrapper.prototype=new ObjectLikeSequence;ObjectWrapper.prototype.root=function(){return this};ObjectWrapper.prototype.isAsync=function(){return false};ObjectWrapper.prototype.get=function(t){return this.source[t]};ObjectWrapper.prototype.each=function(t){var n=this.source,r;for(r in n){if(t(n[r],r)===false){return false}}return true};StringLikeSequence.prototype=new ArrayLikeSequence;StringLikeSequence.define=function(t,n){if(!n||typeof n.get!=="function"){throw new Error("A custom string-like sequence must implement *at least* get!")}return defineSequenceType(StringLikeSequence,t,n)};StringLikeSequence.prototype.value=function(){return this.toString()};StringLikeSequence.prototype.getIterator=function(){return new CharIterator(this)};CharIterator.prototype.current=function(){return this.source.charAt(this.index)};CharIterator.prototype.moveNext=function(){return++this.index<this.source.length()};StringLikeSequence.prototype.charAt=function(t){return this.get(t)};StringLikeSequence.prototype.charCodeAt=function(t){var n=this.charAt(t);if(!n){return NaN}return n.charCodeAt(0)};StringLikeSequence.prototype.substring=function(t,n){return new StringSegment(this,t,n)};StringSegment.prototype=new StringLikeSequence;StringSegment.prototype.get=function(t){return this.parent.get(t+this.start)};StringSegment.prototype.length=function(){return(typeof this.stop==="number"?this.stop:this.parent.length())-this.start};StringLikeSequence.prototype.first=function(t){if(typeof t==="undefined"){return this.charAt(0)}return this.substring(0,t)};StringLikeSequence.prototype.last=function(t){if(typeof t==="undefined"){return this.charAt(this.length()-1)}return this.substring(this.length()-t)};StringLikeSequence.prototype.drop=function(t){return this.substring(t)};StringLikeSequence.prototype.indexOf=function(t,n){return this.toString().indexOf(t,n)};StringLikeSequence.prototype.lastIndexOf=function(t,n){return this.toString().lastIndexOf(t,n)};StringLikeSequence.prototype.contains=function(t){return this.indexOf(t)!==-1};StringLikeSequence.prototype.endsWith=function(t){return this.substring(this.length()-t.length).toString()===t};StringLikeSequence.prototype.startsWith=function(t){return this.substring(0,t.length).toString()===t};StringLikeSequence.prototype.toUpperCase=function(){return this.mapString(function(e){return e.toUpperCase()})};StringLikeSequence.prototype.toLowerCase=function(){return this.mapString(function(e){return e.toLowerCase()})};StringLikeSequence.prototype.mapString=function(t){return new MappedStringLikeSequence(this,t)};MappedStringLikeSequence.prototype=new StringLikeSequence;MappedStringLikeSequence.prototype.get=IndexedMappedSequence.prototype.get;MappedStringLikeSequence.prototype.length=IndexedMappedSequence.prototype.length;StringLikeSequence.prototype.reverse=function(){return new ReversedStringLikeSequence(this)};ReversedStringLikeSequence.prototype=new StringLikeSequence;ReversedStringLikeSequence.prototype.get=IndexedReversedSequence.prototype.get;ReversedStringLikeSequence.prototype.length=IndexedReversedSequence.prototype.length;StringLikeSequence.prototype.toString=function toString(){return this.join("")};StringLikeSequence.prototype.match=function(t){return new StringMatchSequence(this.source,t)};StringMatchSequence.prototype=new Sequence;StringMatchSequence.prototype.getIterator=function(){return new StringMatchIterator(this.source,this.pattern)};StringMatchIterator.prototype.current=function(){return this.match[0]};StringMatchIterator.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))};StringLikeSequence.prototype.split=function(t){return new SplitStringSequence(this.source,t)};SplitStringSequence.prototype=new Sequence;SplitStringSequence.prototype.getIterator=function(){if(this.pattern instanceof RegExp){if(this.pattern.source===""||this.pattern.source==="(?:)"){return new CharIterator(this.source)}else{return new SplitWithRegExpIterator(this.source,this.pattern)}}else if(this.pattern===""){return new CharIterator(this.source)}else{return new SplitWithStringIterator(this.source,this.pattern)}};SplitWithRegExpIterator.prototype.current=function(){return this.source.substring(this.start,this.end)};SplitWithRegExpIterator.prototype.moveNext=function(){if(!this.pattern){return false}var t=this.pattern.exec(this.source);if(t){this.start=this.nextStart?this.nextStart:0;this.end=t.index;this.nextStart=t.index+t[0].length;return true}else if(this.pattern){this.start=this.nextStart;this.end=undefined;this.nextStart=undefined;this.pattern=undefined;return true}return false};SplitWithStringIterator.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)};SplitWithStringIterator.prototype.moveNext=function(){if(!this.finished){this.leftIndex=typeof this.leftIndex!=="undefined"?this.rightIndex+this.delimiter.length:0;this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex)}if(this.rightIndex===-1){this.finished=true;this.rightIndex=undefined;return true}return!this.finished};StringWrapper.prototype=new StringLikeSequence;StringWrapper.prototype.root=function(){return this};StringWrapper.prototype.isAsync=function(){return false};StringWrapper.prototype.get=function(t){return this.source.charAt(t)};StringWrapper.prototype.length=function(){return this.source.length};GeneratedSequence.prototype=new Sequence;GeneratedSequence.prototype.isAsync=function(){return false};GeneratedSequence.prototype.length=function(){return this.fixedLength};GeneratedSequence.prototype.each=function(t){var n=this.get,r=this.fixedLength,i=0;while(typeof r==="undefined"||i<r){if(t(n(i++))===false){return false}}return true};GeneratedSequence.prototype.getIterator=function(){return new GeneratedIterator(this)};GeneratedIterator.prototype.current=function(){return this.currentValue};GeneratedIterator.prototype.moveNext=function(){var t=this.sequence;if(typeof t.fixedLength==="number"&&this.index>=t.fixedLength){return false}this.currentValue=t.get(this.index++);return true};AsyncSequence.prototype=new Sequence;AsyncSequence.prototype.isAsync=function(){return true};AsyncSequence.prototype.getIterator=function(){throw new Error("An AsyncSequence does not support synchronous iteration.")};AsyncSequence.prototype.each=function(t){var n=this.parent.getIterator(),r=this.onNextCallback,i=this.cancelCallback,s=0;var o=new AsyncHandle(function(){if(u){i(u)}});var u=r(function a(){u=null;try{if(n.moveNext()&&t(n.current(),s++)!==false){u=r(a)}else{o._resolve()}}catch(e){o._reject(e)}});return o};var PENDING=1,RESOLVED=2,REJECTED=3;AsyncHandle.prototype.then=function(t,n){var r=new AsyncHandle(this.cancelFn);this.resolveListeners.push(function(e){try{if(typeof t!=="function"){resolve(r,e);return}resolve(r,t(e))}catch(n){r._reject(n)}});this.rejectListeners.push(function(e){try{if(typeof n!=="function"){r._reject(e);return}resolve(r,n(e))}catch(t){r._reject(t)}});if(this.state===RESOLVED){this._resolve(this.value)}if(this.state===REJECTED){this._reject(this.reason)}return r};AsyncHandle.prototype._resolve=function(t){if(this.state===REJECTED){return}if(this.state===PENDING){this.state=RESOLVED;this.value=t}consumeListeners(this.resolveListeners,this.value)};AsyncHandle.prototype._reject=function(t){if(this.state===RESOLVED){return}if(this.state===PENDING){this.state=REJECTED;this.reason=t}consumeListeners(this.rejectListeners,this.reason)};AsyncHandle.prototype.cancel=function(){if(this.cancelFn){this.cancelFn();this.cancelFn=null;this._resolve(false)}};AsyncHandle.prototype.onComplete=function(t){this.resolveListeners.push(t);return this};AsyncHandle.prototype.onError=function(t){this.rejectListeners.push(t);return this};AsyncSequence.prototype.reverse=function(){return this.parent.reverse().async()};AsyncSequence.prototype.find=function(t){var n;var r=this.each(function(e,r){if(t(e,r)){n=e;return false}});return r.then(function(){return n})};AsyncSequence.prototype.indexOf=function(t){var n=-1;var r=this.each(function(e,r){if(e===t){n=r;return false}});return r.then(function(){return n})};AsyncSequence.prototype.contains=function(t){var n=false;var r=this.each(function(e){if(e===t){n=true;return false}});return r.then(function(){return n})};AsyncSequence.prototype.async=function(){return this};ObjectWrapper.prototype.watch=function(t){return new WatchedPropertySequence(this.source,t)};WatchedPropertySequence.prototype=new AsyncSequence;WatchedPropertySequence.prototype.each=function(t){this.listeners.push(t)};StreamLikeSequence.prototype=new AsyncSequence;StreamLikeSequence.prototype.isAsync=function(){return true};StreamLikeSequence.prototype.split=function(t){return new SplitStreamSequence(this,t)};SplitStreamSequence.prototype=new Sequence;SplitStreamSequence.prototype.getEachForDelimiter=function(t){if(t instanceof RegExp){return this.regexEach}return this.stringEach};SplitStreamSequence.prototype.regexEach=function(t){var n=cloneRegex(this.delimiter),r="",i=0,s,o=0;var u=this.parent.each(function(e){r+=e;var u;while(u=n.exec(r)){s=u.index;if(t(r.substring(i,s),o++)===false){return false}i=s+u[0].length}r=r.substring(i);i=0});u.onComplete(function(){if(r.length>0){t(r)}});return u};SplitStreamSequence.prototype.stringEach=function(t){var n=this.delimiter,r=0,i="",s=0;var o=this.parent.each(function(e){i+=e;var s;while((s=i.indexOf(n))>=0){var o=i.substr(0,s);i=i.substr(s+n.length);if(t(o,r++)===false){return false}}return true});o.onComplete(function(){t(i,r++)});return o};StreamLikeSequence.prototype.lines=function(){return this.split("\n")};StreamLikeSequence.prototype.match=function(t){return new MatchedStreamSequence(this,t)};MatchedStreamSequence.prototype=new AsyncSequence;MatchedStreamSequence.prototype.each=function(t){var n=this.pattern,r=false,i=0;return this.parent.each(function(e){Lazy(e).match(n).each(function(e){if(t(e,i++)===false){r=true;return false}});return!r})};Lazy.createWrapper=function(t){var n=function(){this.listeners=[]};n.prototype=new StreamLikeSequence;n.prototype.each=function(e){this.listeners.push(e)};n.prototype.emit=function(e){var t=this.listeners;for(var n=t.length,r=n-1;r>=0;--r){if(t[r](e)===false){t.splice(r,1)}}};return function(){var e=new n;t.apply(e,arguments);return e}};Lazy.generate=function(t,n){return new GeneratedSequence(t,n)};Lazy.range=function(){var t=arguments.length>1?arguments[0]:0,n=arguments.length>1?arguments[1]:arguments[0],r=arguments.length>2?arguments[2]:1;return this.generate(function(e){return t+r*e}).take(Math.floor((n-t)/r))};Lazy.repeat=function(t,n){return Lazy.generate(function(){return t},n)};Lazy.Sequence=Sequence;Lazy.ArrayLikeSequence=ArrayLikeSequence;Lazy.ObjectLikeSequence=ObjectLikeSequence;Lazy.StringLikeSequence=StringLikeSequence;Lazy.StreamLikeSequence=StreamLikeSequence;Lazy.GeneratedSequence=GeneratedSequence;Lazy.AsyncSequence=AsyncSequence;Lazy.AsyncHandle=AsyncHandle;Lazy.clone=function(t){return Lazy(t).value()};Lazy.deprecate=function(t,n){return function(){console.warn(t);return n.apply(this,arguments)}};var arrayPop=Array.prototype.pop,arraySlice=Array.prototype.slice;Set.prototype.add=function(t){var n=this.table,r=typeof t,i,s;switch(r){case"number":case"boolean":case"undefined":if(!n[t]){n[t]=true;return true}return false;case"string":switch(t.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":t="@"+t}if(!n[t]){n[t]=true;return true}return false;default:s=this.objects;if(!arrayContains(s,t)){s.push(t);return true}return false}};Set.prototype.contains=function(t){var n=typeof t,r;switch(n){case"number":case"boolean":case"undefined":return!!this.table[t];case"string":switch(t.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":t="@"+t}return!!this.table[t];default:return arrayContains(this.objects,t)}};Queue.prototype.add=function(t){var n=this.contents,r=n.length,i=this.start;if(this.count===r){n[i]=t;this.start=(i+1)%r}else{n[this.count++]=t}return this};Queue.prototype.toArray=function(){var t=this.contents,n=this.start,r=this.count;var i=t.slice(n,n+r);if(i.length<r){i=i.concat(t.slice(0,r-i.length))}return i};if(typeof module==="object"&&module&&module.exports===context){module.exports=Lazy}else{context.Lazy=Lazy}})(this)